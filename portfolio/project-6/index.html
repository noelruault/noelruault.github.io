<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  <title>Go Callback Service</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Golang simple API that listens for POST requests and requests object information for each incoming request concurrently.">
  <meta name="author" content="Noel Ruault">
  <meta name="generator" content="Hugo 0.103.1" />

  <style>
    :root{
      --primary-color:#366969;
      --logo-font-size:40px;
    }
  </style>

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://noel.engineer/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://noel.engineer/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://noel.engineer/plugins/themify-icons/themify-icons.css ">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://noel.engineer/css/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://noel.engineer/images/favicon.ico " type="image/x-icon">
  <link rel="icon" href="https://noel.engineer/images/favicon.ico " type="image/x-icon">

  
	<!-- Global Site Tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-E0SG7RR73Y"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-E0SG7RR73Y');
	</script>
	

  <!-- OpenGraph meta (alters social media link metadata) -->
  <meta property="og:title" content="Hello, I'm Noël. I write code because I love to." name="title" />
  <meta property="og:image" content="https://noel.engineer/images/meta/og-image.png " name="image" />
  <meta property="og:description" content="Software engineer in all its amplitude. Backend partisan, Unix enthusiast, MacOs user. Always positive, eager, proactive and passionate. Skilled in agile methodologies and team procedures. Determined to achieve success." name="description" />

</head>
<body>
<!-- preloader start -->
<div class="preloader">
  <div id="bounce" alt="preloader"></div>
</div>
<!-- preloader end -->

<header class="navigation nav-fixed-top">
  <nav class="navbar navbar-expand-lg navbar-dark">
    <a class="navbar-brand" href="https://noel.engineer/">
      
      <h3 class="text-white font-tertiary">noel ruault<span id="cursor">|</span></h3>
      
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
      aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse text-center" id="navigation">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="https://noel.engineer/"> Home </a>
        </li>
        
        
        
        
        
        <li class="nav-item ">
          <a class="nav-link" href="https://noel.engineer/about">About</a>
        </li>
        
        
        
        
        
        <li class="nav-item ">
          <a class="nav-link" href="https://noel.engineer/portfolio">Portfolio</a>
        </li>
        
        
        
        
        
        <li class="nav-item ">
          <a class="nav-link" href="https://noel.engineer/contact">Contact</a>
        </li>
        
        
      </ul>
    </div>
  </nav>
</header>


<script>
  var cursor = true;
  var speed = 550;
  setInterval(() => {
    if (cursor) {
      document.getElementById('cursor').style.opacity = 0;
      cursor = false;
    } else {
      document.getElementById('cursor').style.opacity = 1;
      cursor = true;
    }
  }, speed);
</script>




<section class="page-title bg-primary position-relative overflow-hidden">
  <div class="container">
    <div class="row">
      <div class="col-12 text-center">
        <h1 class="text-white font-tertiary">Go Callback Service</h1>
      </div>
    </div>
  </div>
  
  <img src="/images/illustrations/page-title.png" alt="illustrations" class="bg-shape-1 w-100">
  <img src="/images/illustrations/keycap-n-for-noel.svg" alt="illustrations" class="bg-shape-2">
  <img src="/images/illustrations/dots-cyan.svg" alt="illustrations" class="bg-shape-3">
  <img src="/images/illustrations/brackets.svg" alt="illustrations" class="bg-shape-4">
  <img src="/images/illustrations/console.svg" alt="illustrations" class="bg-shape-5">
  <img src="/images/illustrations/dots-group-cyan.svg" alt="illustrations" class="bg-shape-6">
  
</section>




<section class="section portfolio-section">
  <div class="container">
    <div class="row">
      <div class="col-lg-5 mb-5">
        <img src="https://noel.engineer/images/portfolio/cover-9.png" class="img-fluid w-100" alt="Go Callback Service">
      </div>
      <div class="col-lg-7 mb-5 mb-lg-0 align-self-center">
        <div class="row mx-0">
          
          <div class="col-sm-6 mb-5">
            <div class="project-meta">
              <i class="ti-calendar"></i>
              <div class="ml-3">
                <h4>Creation date</h4>
                <p>Apr 19, 2021</p>
              </div>
            </div>
          </div>
          
          
          <div class="col-sm-6 mb-5">
            <div class="project-meta">
              <i class="ti-folder"></i>
              <div class="ml-3">
                <h4>Categories</h4>
                <p>API Client, API Server, Golang, Portfolio, Tracing</p>
              </div>
            </div>
          </div>
          
          <div class="col-sm-6 mb-5">
            <div class="project-meta">
              <i class="ti-link"></i>
              <div class="ml-3">
                <h4>Project Link</h4>
                <p><a href="https://github.com/archived-code-challenges/callback-service">https://github.com/archived-code-challenges/callback-service</a></p>
              </div>
            </div>
          </div>
          
        </div>
      </div>
      <div class="col-lg-11">
        <div class="content"><h1 id="golang-callback-service">Golang Callback Service</h1>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>Golang Callback Service is a simple API that listens for <code>POST</code> requests in <code>/callback</code> and requests object information for each incoming <code>object_id</code> concurrently. Validates the request, returns a response, and processes the payload. Thus, avoiding bottlenecks in a thread-safe way.</p>
<h2 id="dependencies">Dependencies</h2>
<p>This project was designed against Go 1.16.
Supporting services like the database are hosted in Docker and use Docker Compose to startup.</p>
<ul>
<li>Golang</li>
<li>Docker</li>
<li>Docker compose</li>
</ul>
<h2 id="api-request">API Request</h2>
<p><code>cmd/callback-service</code></p>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th style="text-align:center">HTTP Method</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/callback</code></td>
<td style="text-align:center"><code>POST</code></td>
<td style="text-align:center"><code>Create objects</code></td>
</tr>
<tr>
<td><code>/</code></td>
<td style="text-align:center"><code>GET</code></td>
<td style="text-align:center"><code>Health check</code></td>
</tr>
</tbody>
</table>
<p><code>cmd/client-service</code></p>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th style="text-align:center">HTTP Method</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/objects/:id</code></td>
<td style="text-align:center"><code>GET</code></td>
<td style="text-align:center"><code>Retrieves object</code></td>
</tr>
</tbody>
</table>
<h2 id="decisions-taken-on-this-implementation">Decisions taken on this implementation</h2>
<h3 id="product">Product</h3>
<ul>
<li>Given a request to the server, the payload will be validated and a response will be returned to the client before processing is completed.</li>
<li>Errors that occur while data is being processed in goroutines are logged.</li>
<li>Deletion of data on the database is executed exactly N seconds after insertion.</li>
<li>Unit and integration tested.</li>
</ul>
<h3 id="design">Design</h3>
<ul>
<li>Unhandled error fail-safe. An unhandled error will output as internal_error.</li>
<li>Captures logs. Stores traces with Zipkin and profiles memory usage with <em>pprof</em>.</li>
<li>The core parts of the application are documented.</li>
<li>Service variables can be modified at execution time.</li>
<li>The folder structure follows a package-oriented design to maintain the best possible purpose, usability, and portability.</li>
<li>The project dependencies are located in the vendor folder.</li>
<li>When stopped, the service tries to shut down gracefully. Logging any errors that may occur.</li>
</ul>
<h2 id="instructions-to-run-the-project">Instructions to run the project</h2>
<p>If the host operating system is MacOS, I&rsquo;ve tried to configure the whole thing with one command (<a href="(Makefile#L46)"><code>make compose-mac</code></a>) but couldn&rsquo;t make work a docker-compose approach <a href="https://docs.docker.com/docker-for-mac/networking/#known-limitations-use-cases-and-workarounds">due to networking limitations</a> when talking between containers.</p>
<p>Thus, to <strong>start everything on a MacOS</strong> you must have the previously listed <a href="#dependencies">dependencies</a> installed:</p>
<pre><code>make compose-local-mac
</code></pre>
<blockquote>
<p>Any flag attribute listed when the application starts can be changed at execution time. Check <a href="Makefile#L46">Makefile (line 46)</a> for an extended illustration.
Therefore, the client-server could be changed if required:
<code>make compose-local-mac LDFLAGS=--callback-service-address=http://1234host:7777</code>
This functionality can be used to easily (for example) switch URL references between the services involved.</p>
</blockquote>
<p>With a Linux machine, the docker-compose approach should work, setting up everything at once:
<em>(Not tested)</em></p>
<pre><code>make compose-linux
</code></pre>
<p>To start the client service that will query the server every 5 seconds and also provide the status of the objects:</p>
<pre><code>make client-start
</code></pre>
<p>To explore what else you can do with the Makefile:</p>
<pre><code>make
</code></pre>
<p>After successful execution, the service should be running on port 9090. Hit the <em>health</em> endpoint to check that all is running as expected:</p>
<ul>
<li><a href="http://localhost:9090/">:9090</a></li>
</ul>
<p>Tracing can be found at:</p>
<ul>
<li><a href="http://localhost:9411/zipkin/">:9411/zipkin/</a></li>
<li><a href="http://localhost:6060/debug/pprof/">:6060/debug/pprof/</a></li>
</ul>
<p><img src="/doc/zipkin-traces.png" alt="zipkin-traces"></p>
<h2 id="testing">Testing</h2>
<p>The tests point to a different database created just for them, so they are isolated from the core service.</p>
<p>Project tests can be run by typing:</p>
<pre><code>make test
</code></pre>
<p>Integration tests (which require both services running) can be performed by typing:</p>
<pre><code>make test-integration
</code></pre>
<h2 id="packaging">Packaging</h2>
<pre><code>.
├── cmd                     # Entrypoint
│   ├── callback-service    # Main API
│   └── client-service      # Client API (provided by the task)
├── doc                     # API Documentation, images, and helpful files
└── internal
    ├── handlers            # HTTP layer &amp; integration tests
    ├── middleware
    ├── models              # Business logic
    └── web                 # Framework for common HTTP related tasks
</code></pre>
<h2 id="use-of-external-libraries">Use of external libraries</h2>
<ul>
<li><a href="https://github.com/go-gorm/gorm">gorm</a>. ORM library.</li>
<li>Zipkin, go-zipkin, and Opencensus. Distributed tracing system</li>
<li><a href="https://github.com/go-chi/chi">go-chi</a>. Router for building Golang HTTP services.</li>
<li><a href="github.com/ardanlabs/conf">conf</a>. Support for using environmental variables and command-line arguments for configuration.</li>
</ul>
<h2 id="author">Author</h2>
<p>Noel Ruault - <a href="https://github.com/noelruault">@noelruault</a></p>
<h2 id="license">License</h2>
<p>Copyright © 2020 <a href="https://github.com/noelruault">@noelruault</a>.
This project is <a href="https://opensource.org/licenses/MIT">MIT</a> licensed.</p>
</div>
      </div>
    </div>
  </div>
</section>





<footer class="bg-dark footer-section">
  <div class="section">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <h5 class="text-light">Email</h5>
          <p class="text-white paragraph-lg font-secondary">contact@noel.engineer</p>
        </div>
        <div class="col-md-4">
          <h5 class="text-light">Phone</h5>
          <p class="text-white paragraph-lg font-secondary">&#43;34 722 122 274</p>
        </div>
        <div class="col-md-4">
          <h5 class="text-light">Address</h5>
          <p class="text-white paragraph-lg font-secondary">127.0.0.1, Mallorca</p>
        </div>
      </div>
    </div>
  </div>
  <div class="border-top text-center border-dark py-5">
    <p class="mb-0 text-light">Developed with &lt;3 by Noël Ruault</p>
    <p class="mb-0 text-light">Copyright © 2022 a <a href="https://github.com/themefisher/kross-hugo/blob/master/LICENSE">MIT</a> theme by <a href="https://gohugo.io">HUGO</a></p>
  </div>
</footer>


<!-- Google Map API -->


<!-- JS Plugins -->

<script src="https://noel.engineer/plugins/jQuery/jquery.min.js"></script>

<script src="https://noel.engineer/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://noel.engineer/plugins/slick/slick.min.js"></script>

<script src="https://noel.engineer/plugins/shuffle/shuffle.min.js"></script>

<script src="https://noel.engineer/plugins/google-map/map.js"></script>


<!-- Main Script -->

<script src="https://noel.engineer/js/script.min.js"></script>




  

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js"></script>
  <div id="js-cookie-box" class="cookie-box-hide cookie-box cookies-banner">
    <div class="cookies-banner__body">
      <div class="mb-3">
        <br> This site uses cookies.
      </div>

      <div class="mb-3">
        <div class="cookies-banner__pre">
          <div class="cookies-banner__pre-inner">
            By continuing to use this website, you agree to their use.
            <br><br>

            <div class="cookies-banner__link">
              <a id="js-cookie-yes-button" class="cookies-banner__choice-link">
                [<b>Y</b>]es, I agree
              </a>
            </div>
          </div>
        </div>

        <div id="js-close-cookie-button" class="cookies-banner__close-button">[X]</div>
      </div>
    </div>
  </div>

  <script>
    (function ($) {
      const cookieBox = document.getElementById('js-cookie-box');
      const cookieButton = document.getElementById('js-close-cookie-button');
      const cookieYesButton = document.getElementById('js-cookie-yes-button');

      if (!Cookies.get('cookie-box')) {
        cookieBox.classList.remove('cookie-box-hide');
        cookieButton.onclick = function () {
          Cookies.set('cookie-box', true, {
            expires:  1 
          });
          cookieBox.classList.add('cookie-box-hide');
        };
        cookieYesButton.onclick = function () {
            Cookies.set('cookie-box', true, {
              expires:  1 
          });
          cookieBox.classList.add('cookie-box-hide');
        };
      }
    }) (jQuery);
  </script>

  
  


</body>

</html>