<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  <title>Golang Authentication Service</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Golang micro-service implemented with an MVC pattern to manage access to Users.">
  <meta name="author" content="Noel Ruault">
  <meta name="generator" content="Hugo 0.104.3" />

  <style>
    :root{
      --primary-color:#366969;
      --logo-font-size:40px;
    }
  </style>

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://noel.engineer/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://noel.engineer/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://noel.engineer/plugins/themify-icons/themify-icons.css ">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://noel.engineer/css/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://noel.engineer/images/favicon.ico " type="image/x-icon">
  <link rel="icon" href="https://noel.engineer/images/favicon.ico " type="image/x-icon">

  
	<!-- Global Site Tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-E0SG7RR73Y"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-E0SG7RR73Y');
	</script>
	

  <!-- OpenGraph meta (alters social media link metadata) -->
  <meta property="og:title" content="Hello, I'm NoÃ«l. I write code because I love to." name="title" />
  <meta property="og:image" content="https://noel.engineer/images/meta/og-image.png " name="image" />
  <meta property="og:description" content="Software engineer in all its amplitude. Backend partisan, Unix enthusiast, MacOs user. Always positive, eager, proactive and passionate. Skilled in agile methodologies and team procedures. Determined to achieve success." name="description" />

</head>
<body>
<!-- preloader start -->
<div class="preloader">
  <div id="bounce" alt="preloader"></div>
</div>
<!-- preloader end -->

<header class="navigation nav-fixed-top">
  <nav class="navbar navbar-expand-lg navbar-dark">
    <a class="navbar-brand" href="https://noel.engineer/">
      
      <h3 class="text-white font-tertiary">noel ruault<span id="cursor">|</span></h3>
      
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
      aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse text-center" id="navigation">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="https://noel.engineer/"> Home </a>
        </li>
        
        
        
        
        
        <li class="nav-item ">
          <a class="nav-link" href="https://noel.engineer/about">About</a>
        </li>
        
        
        
        
        
        <li class="nav-item ">
          <a class="nav-link" href="https://noel.engineer/portfolio">Portfolio</a>
        </li>
        
        
        
        
        
        <li class="nav-item ">
          <a class="nav-link" href="https://noel.engineer/contact">Contact</a>
        </li>
        
        
      </ul>
    </div>
  </nav>
</header>


<script>
  var cursor = true;
  var speed = 550;
  setInterval(() => {
    if (cursor) {
      document.getElementById('cursor').style.opacity = 0;
      cursor = false;
    } else {
      document.getElementById('cursor').style.opacity = 1;
      cursor = true;
    }
  }, speed);
</script>




<section class="page-title bg-primary position-relative overflow-hidden">
  <div class="container">
    <div class="row">
      <div class="col-12 text-center">
        <h1 class="text-white font-tertiary">Golang Authentication Service</h1>
      </div>
    </div>
  </div>
  
  <img src="/images/illustrations/page-title.png" alt="illustrations" class="bg-shape-1 w-100">
  <img src="/images/illustrations/keycap-n-for-noel.svg" alt="illustrations" class="bg-shape-2">
  <img src="/images/illustrations/dots-cyan.svg" alt="illustrations" class="bg-shape-3">
  <img src="/images/illustrations/brackets.svg" alt="illustrations" class="bg-shape-4">
  <img src="/images/illustrations/console.svg" alt="illustrations" class="bg-shape-5">
  <img src="/images/illustrations/dots-group-cyan.svg" alt="illustrations" class="bg-shape-6">
  
</section>




<section class="section portfolio-section">
  <div class="container">
    <div class="row">
      <div class="col-lg-5 mb-5">
        <img src="https://noel.engineer/images/portfolio/cover-2.png" class="img-fluid w-100" alt="Golang Authentication Service">
      </div>
      <div class="col-lg-7 mb-5 mb-lg-0 align-self-center">
        <div class="row mx-0">
          
          <div class="col-sm-6 mb-5">
            <div class="project-meta">
              <i class="ti-calendar"></i>
              <div class="ml-3">
                <h4>Creation date</h4>
                <p>Apr 06, 2021</p>
              </div>
            </div>
          </div>
          
          
          <div class="col-sm-6 mb-5">
            <div class="project-meta">
              <i class="ti-folder"></i>
              <div class="ml-3">
                <h4>Categories</h4>
                <p>Golang, JWT Authentication, Oauth, Portfolio</p>
              </div>
            </div>
          </div>
          
          <div class="col-sm-6 mb-5">
            <div class="project-meta">
              <i class="ti-link"></i>
              <div class="ml-3">
                <h4>Project Link</h4>
                <p><a href="https://github.com/archived-code-challenges/auth-service">https://github.com/archived-code-challenges/auth-service</a></p>
              </div>
            </div>
          </div>
          
        </div>
      </div>
      <div class="col-lg-11">
        <div class="content"><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="golang-authentication-service">Golang authentication service</h1>
<p>Small microservice to manage access to Users</p>
<h2 id="technical-decisions">Technical decisions</h2>
<ul>
<li>I have limited authentication and is only used when <strong>removing</strong> a User resource. The middlewares will check if a user is authenticated and is removing resource of its own. Therefore, to remove a user through the API, you must authenticate with its credentials beforehand.</li>
</ul>
<h3 id="external-dependencies">External dependencies</h3>
<ul>
<li>I have used <a href="https://gorm.io">GORM</a> to manage the database transactions.</li>
<li>And <a href="https://github.com/go-chi/chi">go-chi</a> to extend some HTTP service attributes.</li>
</ul>
<h2 id="possible-extensions-or-improvements">Possible extensions or improvements</h2>
<ul>
<li>When deploying to production, I would like to know if the number of requests for the service is very large, perhaps the tracing service can slow down performance.</li>
<li>I would extend authentication to use roles, to allow users to have specific permissions.</li>
<li>I have been used the attributes active and settings as a good practice but they are not completely functional and with some more time I would extend their functionality.</li>
<li>Some things have not been tested, the functionality is (overall) correct but with a little more time I would have ensured 90%+ coverage.</li>
<li>The migration method could be extended to use previous states of the database.</li>
</ul>
<h3 id="data-structure">Data structure</h3>
<ul>
<li><a href="#authentication">Authentication</a>
<ul>
<li><a href="#with-password">With password</a></li>
<li><a href="#with-refresh-token">With refresh token</a></li>
</ul>
</li>
<li><a href="#user">User</a></li>
</ul>
<h3 id="authentication">Authentication</h3>
<h4 id="with-password">With password</h4>
<p>The request must be sent form-encoded, and the response will be sent JSON encoded.</p>
<p><strong>Request:</strong></p>
<pre><code>POST /api/oauth/login
Content-Type: application/x-www-form-urlencoded

grant_type=password
&amp;email=user@example.com
&amp;password=1234secret
</code></pre>
<p>Parameters:</p>
<ul>
<li><strong>grant_type</strong>: Must be &ldquo;password&rdquo;.</li>
<li><strong>email</strong>: User&rsquo;s email address.</li>
<li><strong>password</strong>: User&rsquo;s password.</li>
</ul>
<h4 id="with-refresh-token">With refresh token</h4>
<p>The request must be sent form-encoded, and the response will be sent JSON encoded.</p>
<p>A token request using a refresh token will return a new, current access token as well as a new refresh token, extending the lifetime of the user session and reducing chances of the user needing to login again to the system, as long as the user access the system frequently.</p>
<p><strong>Request:</strong></p>
<pre><code>POST /api/oauth/login
Content-Type: application/x-www-form-urlencoded

grant_type=refresh_token
&amp;refresh_token=IwOGYzYTlmM2YxOTQ5MGE3YmNmMDFkNTVk
</code></pre>
<p>Parameters:</p>
<ul>
<li><strong>grant_type</strong>: Must be &ldquo;refresh_token&rdquo;.</li>
<li><strong>refresh_token</strong>: A previously issued refresh_token.</li>
</ul>
<h3 id="user">User</h3>
<p>A <strong>User</strong> resource represents a user of the system.</p>
<p><strong>Fields:</strong></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>id</strong></td>
<td>int</td>
<td></td>
<td>User ID in the database.</td>
</tr>
<tr>
<td><strong>active</strong></td>
<td>bool</td>
<td>true</td>
<td>Whether the account is active. An inactive account is not able to login to the application, or perform any actions via the API.</td>
</tr>
<tr>
<td><strong>country</strong></td>
<td>string</td>
<td></td>
<td>Country code on <a href="https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes">ISO 3166-1 format</a>.</td>
</tr>
<tr>
<td><strong>email</strong></td>
<td>string</td>
<td></td>
<td>User email address. Used for user identification, login. Is a <strong>mandatory</strong> field and <strong>must be unique</strong> in the application.</td>
</tr>
<tr>
<td><strong>firstName</strong>, <strong>lastName</strong></td>
<td>string</td>
<td></td>
<td>User name details. The first name is <strong>mandatory.</strong></td>
</tr>
<tr>
<td><strong>nickname</strong></td>
<td>string</td>
<td></td>
<td>User nickname.</td>
</tr>
<tr>
<td><strong>password</strong></td>
<td>string</td>
<td></td>
<td>User password. <strong>Must be passed on create/update operations</strong>. It&rsquo;s never returned on any read operations.</td>
</tr>
<tr>
<td><strong>settings</strong></td>
<td>string</td>
<td>{}</td>
<td>A string used to store user preferences like dark mode or similar profile data.</td>
</tr>
</tbody>
</table>
<h2 id="instructions-to-run-the-project">Instructions to run the project</h2>
<p>If the host operating system is MacOS:</p>
<pre><code>make compose-mac
</code></pre>
<p>If it is Linux:</p>
<pre><code>make compose-linux
</code></pre>
<p>On a first startup, the database should be initialised by running</p>
<pre><code>go run ./cmd/admin/main.go migrate
</code></pre>
<p>After successful execution, the service should be running on port 8080:</p>
<ul>
<li><a href="http://localhost:8080/">:8080</a></li>
</ul>
<p>Tracing can be found at:</p>
<ul>
<li><a href="http://localhost:9411/zipkin/">:9411/zipkin/</a></li>
<li><a href="http://localhost:6060/debug/pprof/">:6060/debug/pprof/</a></li>
</ul>
<p><img src="/doc/assets/tracing-support.png" alt="image-tracing-support"></p>
<p>Project tests can be run by typing:</p>
<pre><code>make test
</code></pre>
<p>To explore what you can do with the Makefile:</p>
<pre><code>make
</code></pre>
<h2 id="api-usage">API usage</h2>
<p>The project has a <a href="/doc/golang-authetication-service.postman_collection.json">Postman collection</a> attached, which can be used to interact with the authentication/user service.</p>
<h3 id="packaging">Packaging</h3>
<pre><code>âââ cmd             # Entrypoint
â   âââ admin       # Admin (database) related tasks and x509 key creator for the auth service
â   âââ api         # Main API
âââ doc             # Documentation, images and helpful files
âââ internal
    âââ errors      # Utilities that make easier error handling throughout the project
    âââ handlers    # HTTP layer
    âââ middleware
    âââ models      # Business logic
    âââ schema      # Framework for common database related tasks
    âââ web         # Framework for common HTTP related tasks
</code></pre>
<h3 id="benchmarking">Benchmarking</h3>
<p>I have benchmarked the two most computationally expensive points of the API: The PUT method and authentication.
Here are the results:</p>
<pre><code>ali --body-file=./doc/assets/ali-update.json --method=PUT http://localhost:8080/api/users/1
</code></pre>
<p><img src="/doc/assets/bench-put-user.gif" alt="bench-put-user.gif"></p>
<blockquote>
<p>Benchmark: <strong>50</strong> requests per second. Min: 12~ ms. Max: 120~ ms.</p>
</blockquote>
<hr>
<pre><code>ali --rate=10 --method=POST http://localhost:8080/oauth/login/bench/
</code></pre>
<p><img src="/doc/assets/bench-auth.gif" alt="bench-auth.gif"></p>
<blockquote>
<p>Benchmark: <strong>10</strong> requests per second. Min: 370~ ms. Max: 730~ ms.</p>
</blockquote>
</div>
      </div>
    </div>
  </div>
</section>





<footer class="bg-dark footer-section">
  <div class="section">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <h5 class="text-light">Email</h5>
          <p class="text-white paragraph-lg font-secondary">contact@noel.engineer</p>
        </div>
        <div class="col-md-4">
          <h5 class="text-light">Phone</h5>
          <p class="text-white paragraph-lg font-secondary">&#43;34 722 122 274</p>
        </div>
        <div class="col-md-4">
          <h5 class="text-light">Address</h5>
          <p class="text-white paragraph-lg font-secondary">127.0.0.1, Mallorca</p>
        </div>
      </div>
    </div>
  </div>
  <div class="border-top text-center border-dark py-5">
    <p class="mb-0 text-light">Developed with &lt;3 by NoÃ«l Ruault</p>
    <p class="mb-0 text-light">Copyright Â© 2022 a <a href="https://github.com/themefisher/kross-hugo/blob/master/LICENSE">MIT</a> theme by <a href="https://gohugo.io">HUGO</a></p>
  </div>
</footer>


<!-- Google Map API -->


<!-- JS Plugins -->

<script src="https://noel.engineer/plugins/jQuery/jquery.min.js"></script>

<script src="https://noel.engineer/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://noel.engineer/plugins/slick/slick.min.js"></script>

<script src="https://noel.engineer/plugins/shuffle/shuffle.min.js"></script>

<script src="https://noel.engineer/plugins/google-map/map.js"></script>


<!-- Main Script -->

<script src="https://noel.engineer/js/script.min.js"></script>




  

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js"></script>
  <div id="js-cookie-box" class="cookie-box-hide cookie-box cookies-banner">
    <div class="cookies-banner__body">
      <div class="mb-3">
        <br> This site uses cookies.
      </div>

      <div class="mb-3">
        <div class="cookies-banner__pre">
          <div class="cookies-banner__pre-inner">
            By continuing to use this website, you agree to their use.
            <br><br>

            <div class="cookies-banner__link">
              <a id="js-cookie-yes-button" class="cookies-banner__choice-link">
                [<b>Y</b>]es, I agree
              </a>
            </div>
          </div>
        </div>

        <div id="js-close-cookie-button" class="cookies-banner__close-button">[X]</div>
      </div>
    </div>
  </div>

  <script>
    (function ($) {
      const cookieBox = document.getElementById('js-cookie-box');
      const cookieButton = document.getElementById('js-close-cookie-button');
      const cookieYesButton = document.getElementById('js-cookie-yes-button');

      if (!Cookies.get('cookie-box')) {
        cookieBox.classList.remove('cookie-box-hide');
        cookieButton.onclick = function () {
          Cookies.set('cookie-box', true, {
            expires:  1 
          });
          cookieBox.classList.add('cookie-box-hide');
        };
        cookieYesButton.onclick = function () {
            Cookies.set('cookie-box', true, {
              expires:  1 
          });
          cookieBox.classList.add('cookie-box-hide');
        };
      }
    }) (jQuery);
  </script>

  
  


</body>

</html>